<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>
        memo.tomtsutom.com
    </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.1/styles/monokai-sublime.min.css" />
    
<link rel="stylesheet" href="/css/style.css">

    <meta property="og:type" content="article">
    <meta property="og:title" content="GitHubのコード埋め込みテスト">
    <meta property="og:url" content="https://memo.tomtsutom.com/">
    <meta property="og:site_name" content="memo.tomtsutom.com">
    
        <meta property="og:updated_time" content="2020-12-22T22:13:17.138Z">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="GitHubのコード埋め込みテスト">
    <meta name="twitter:description" content="GitHubのコードを引用して埋め込み表示を行うテスト投稿です。">
    <meta name="twitter:creator" content="@tsutomu_ikeda">
<meta name="generator" content="Hexo 5.2.0"></head>


<body id="bodyx">
    <div class="hd posts">
    <div class="post-top-title">
        <a href="/">tomtsutomの雑記帳</a>
    </div>
    <div class="post-title">
        GitHubのコード埋め込みテスト
    </div>
    <p class="post-meta">
    
        初回投稿日時: 2020/12/12 02:51:52 <br>
        最終更新日時: 2020/12/23 07:13:17 <br>
    
    </p>
    <hr>
    <div class="post-content">
        <h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>この記事はGitHubのコードを埋め込むテストのためのものです。<br>コード埋め込みというと、通常はバッククォート3つで囲い、Markdownに直接記述します。もちろんこれでも表示する上では問題ないのですが、少しもやっとします。プログラミングでコードを書き、さらにブログを執筆する際にもまだコードを書かなければならない。<code>DRY原則</code> を忠実に守るためにも一度書いたコードを繰り返したくはありません。そこで、GitHubのコードを自動的に取得し、埋め込む仕組みを作ってみました。<br>なお、この仕組みは<a target="_blank" rel="noopener" href="https://note.nkmk.me/">nkmkさん</a>の<a target="_blank" rel="noopener" href="https://github.com/nkmk/hexo-tag-github-code">hexo-tag-github-code</a>を参考にして作っています。コードを公開してくださり誠にありがとうございます。</p>
<h2 id="様々な種類のコードをGitHubから持ってきてみる"><a href="#様々な種類のコードをGitHubから持ってきてみる" class="headerlink" title="様々な種類のコードをGitHubから持ってきてみる"></a>様々な種類のコードをGitHubから持ってきてみる</h2><h3 id="Rustコードのサンプル"><a href="#Rustコードのサンプル" class="headerlink" title="Rustコードのサンプル"></a>Rustコードのサンプル</h3><p>昔作った決定性有限オートマトンのRustによる実装を埋め込んでみます。話は逸れますが、Rustのパターンマッチングってものすごく便利ですよね。パターンマッチングのおかげで状態遷移図を何も考えずにそのまま転写するだけで実装できました。</p>
<h4 id="オリジナルコード"><a href="#オリジナルコード" class="headerlink" title="オリジナルコード"></a>オリジナルコード</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% ghcode https://github.com/Tsutomu-Ikeda/rust-dfa/blob/master/src/main.rs 23 36 %&#125;</span><br></pre></td></tr></table></figure>

<h4 id="埋め込み結果"><a href="#埋め込み結果" class="headerlink" title="埋め込み結果"></a>埋め込み結果</h4><figure class="highlight rs"><figcaption><span>main.rs#L23-L36</span><a target="_blank" rel="noopener" href="https://github.com/Tsutomu-Ikeda/rust-dfa/blob/master/src/main.rs#L23-L36">GitHubでみる</a></figcaption><table><tr><td class="gutter"><pre><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> fmt::Display <span class="keyword">for</span> States &#123;</span><br><span class="line">  <span class="function"><span class="keyword">fn</span> <span class="title">fmt</span></span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> fmt::Formatter) -&gt; fmt::<span class="built_in">Result</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> printable = <span class="keyword">match</span> *<span class="keyword">self</span> &#123;</span><br><span class="line">      States::S0 =&gt; <span class="string">&quot;S0&quot;</span>,</span><br><span class="line">      States::S1 =&gt; <span class="string">&quot;S1&quot;</span>,</span><br><span class="line">      States::S2 =&gt; <span class="string">&quot;S2&quot;</span>,</span><br><span class="line">      States::S3 =&gt; <span class="string">&quot;S3&quot;</span>,</span><br><span class="line">      States::S4 =&gt; <span class="string">&quot;S4&quot;</span>,</span><br><span class="line">      States::S5 =&gt; <span class="string">&quot;S5&quot;</span>,</span><br><span class="line">      States::S6 =&gt; <span class="string">&quot;S6&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">write!</span>(f, <span class="string">&quot;&#123;&#125;&quot;</span>, printable)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>match</code> を含めてすべての予約語がしっかりとハイライトされています。ただ変数名などはハイライトされていません。<code>highlight.js</code> の特性上あまり重い処理はできなさそうなので、しょうがないのでしょうか…</p>
<h3 id="Pythonコードのサンプル"><a href="#Pythonコードのサンプル" class="headerlink" title="Pythonコードのサンプル"></a>Pythonコードのサンプル</h3><h4 id="オリジナルコード-1"><a href="#オリジナルコード-1" class="headerlink" title="オリジナルコード"></a>オリジナルコード</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% ghcode https://github.com/selelab/admin/blob/master/api/accounting/models.py 14 30 %&#125;</span><br></pre></td></tr></table></figure>

<h4 id="埋め込み結果-1"><a href="#埋め込み結果-1" class="headerlink" title="埋め込み結果"></a>埋め込み結果</h4><figure class="highlight py"><figcaption><span>models.py#L14-L30</span><a target="_blank" rel="noopener" href="https://github.com/selelab/admin/blob/master/api/accounting/models.py#L14-L30">GitHubでみる</a></figcaption><table><tr><td class="gutter"><pre><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Project</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = models.UUIDField(primary_key=<span class="literal">True</span>, default=uuid.uuid4, editable=<span class="literal">False</span>)</span><br><span class="line">    title = models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line">    description = models.CharField(max_length=<span class="number">500</span>)</span><br><span class="line">    accounting_type = models.CharField(max_length=<span class="number">10</span>,</span><br><span class="line">                                       choices=ACCOUNTING_TYPES,</span><br><span class="line">                                       default=<span class="string">&#x27;soft&#x27;</span>)</span><br><span class="line">    leader = models.ForeignKey(User,</span><br><span class="line">                               on_delete=models.PROTECT,</span><br><span class="line">                               null=<span class="literal">True</span>,</span><br><span class="line">                               blank=<span class="literal">True</span>)</span><br><span class="line">    closed = models.BooleanField(default=<span class="literal">False</span>)</span><br><span class="line">    date_created = models.DateTimeField(default=utils.timezone.now, editable=<span class="literal">False</span>)</span><br><span class="line">    date_updated = models.DateTimeField(auto_now=<span class="literal">True</span>, editable=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        ordering = [<span class="string">&#x27;-date_updated&#x27;</span>, <span class="string">&#x27;-date_created&#x27;</span>, <span class="string">&#x27;id&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>Pythonも変数名がハイライトされていません。しかし、文字列リテラルや数値リテラルはしっかりと認識されているようです。</p>
<h3 id="zshrc-のサンプル"><a href="#zshrc-のサンプル" class="headerlink" title=".zshrc のサンプル"></a><code>.zshrc</code> のサンプル</h3><p><code>.zshrc</code> は頻繁に更新するファイルで、行がずれる恐れがあるため、コミットIDを指定して埋め込みました。</p>
<h4 id="オリジナルコード-2"><a href="#オリジナルコード-2" class="headerlink" title="オリジナルコード"></a>オリジナルコード</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% ghcode https://github.com/Tsutomu-Ikeda/settings/blob/b487a295006849856deaa5ec646e1b7e23a5ea6f/unix/home/.zshrc 118 128 %&#125;</span><br></pre></td></tr></table></figure>

<h4 id="埋め込み結果-2"><a href="#埋め込み結果-2" class="headerlink" title="埋め込み結果"></a>埋め込み結果</h4><figure class="highlight zsh"><figcaption><span>.zshrc#L118-L128</span><a target="_blank" rel="noopener" href="https://github.com/Tsutomu-Ikeda/settings/blob/b487a295006849856deaa5ec646e1b7e23a5ea6f/unix/home/.zshrc#L118-L128">GitHubでみる</a></figcaption><table><tr><td class="gutter"><pre><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;/usr/local/opt/mysql-client/bin:<span class="variable">$HOME</span>/.yarn/bin:<span class="variable">$HOME</span>/.config/yarn/global/node_modules/.bin:<span class="variable">$HOME</span>/.cargo/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">export</span> WORDCHARS=<span class="string">&quot;*?_-.[]~=&amp;;!#$%^()&#123;&#125;&lt;&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> <span class="variable">$HOME</span>/.zsh/greeting.zsh</span><br><span class="line"></span><br><span class="line"><span class="comment"># To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.</span></span><br><span class="line">[[ ! -f ~/.p10k.zsh ]] || <span class="built_in">source</span> ~/.p10k.zsh &amp;&amp; <span class="built_in">source</span> <span class="variable">$HOME</span>/.zsh/p10k.zsh</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -e <span class="string">&quot;<span class="variable">$&#123;HOME&#125;</span>/.iterm2_shell_integration.zsh&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">source</span> <span class="string">&quot;<span class="variable">$&#123;HOME&#125;</span>/.iterm2_shell_integration.zsh&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>一見ちゃんとハイライトされているように見えて実はうまく行っていません。コメントは1行しかないはずなのにずっと続いていることになってしまっています。</p>

    </div>
    <hr>
</div>

    
<div class="footer" id="footer">
    <p>Copyright © 2020 <a class="flink" target="_blank" rel="noopener" href="https://tomtsutom.com">tomtsutom</a>.
        <label class="el-switch el-switch-green el-switch-sm" style="vertical-align: sub;">
            <input type="checkbox" name="switch" id="update_style">
        </label>
    </p>
</div>
<input type="hidden" id="web_style" value="black">

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.1/highlight.min.js"></script>
<script src="https://kit.fontawesome.com/c898920549.js" crossorigin="anonymous"></script>
<script src='/js/js.js'></script>
<style type="text/css">
.v * {
    color: #698fca;
}

.v .vlist .vcard .vhead .vsys {
    color: #404040;
}

.v .vlist .vcard .vh .vmeta .vat {
    color: #638fd5;
}

.v .vlist .vcard .vhead .vnick {
    color: #6ba1ff;
}

.v a {
    color: #8696b1;
}

.v .vlist .vcard .vhead .vnick:hover {
    color: #669bfc;
}
</style>

</body>

</html>
